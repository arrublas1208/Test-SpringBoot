spring.application.name=logitrack

# Configuración para despliegue en Tomcat externo (WAR)
# IMPORTANTE: Esto desactiva el servidor embebido de Spring Boot
spring.main.web-application-type=servlet

# Puerto configurable: usa env var PORT si está definido; por defecto 8081
# NOTA: Este puerto solo se usa si se ejecuta con java -jar (no en Tomcat)
server.port=${PORT:8081}
# Context path para despliegue en Tomcat
server.servlet.context-path=/

# Datasource (PROD/QA: MySQL, NADA en memoria)
# IMPORTANTE: Configurar variables de entorno DB_URL, DB_USERNAME, DB_PASSWORD antes de desplegar
spring.datasource.url=${DB_URL:jdbc:mysql://localhost:3306/logitrack_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true&createDatabaseIfNotExist=true}
spring.datasource.username=${DB_USERNAME:campus2023}
spring.datasource.password=${DB_PASSWORD:campus2023}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.hibernate.ddl-auto=none

# Inicialización de scripts SQL (schema + data)
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:schema.sql
spring.sql.init.data-locations=classpath:data.sql

# Swagger
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
# Usar nombres camelCase para compatibilidad con Springdoc 2.x
springdoc.packagesToScan=com.logitrack.controller
springdoc.pathsToMatch=/api/**

# Jackson
spring.jackson.serialization.FAIL_ON_EMPTY_BEANS=false

# JPA: desactivar Open Session In View
spring.jpa.open-in-view=false

# Logging springdoc
logging.level.org.springdoc=DEBUG
logging.level.io.swagger.v3=DEBUG

# Mostrar detalles en errores (DESACTIVADO para producción - seguridad)
server.error.include-message=never
server.error.include-stacktrace=never

# Límites de seguridad para prevenir DoS
server.tomcat.max-http-post-size=10485760
server.tomcat.max-swallow-size=2097152
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# JWT Configuration
# CRÍTICO: Cambiar JWT_SECRET en producción por una clave de 256+ bits
# Generar con: openssl rand -base64 64
jwt.secret=${JWT_SECRET:CHANGE-THIS-SECRET-IN-PRODUCTION-USE-AT-LEAST-256-BITS-RANDOM-STRING-HERE!!}
jwt.validity-ms=${JWT_VALIDITY_MS:3600000}

# Reportes: configuración de umbrales
reportes.stock-bajo.threshold=10
reportes.stock-bajo.max-threshold=1000

# Logging para diagnóstico de arranque JPA/Hibernate
logging.level.org.hibernate=INFO
logging.level.org.springframework.orm.jpa=DEBUG
logging.level.org.springframework.boot.autoconfigure.orm.jpa=DEBUG
